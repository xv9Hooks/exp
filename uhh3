--[[
    NexusUI InterfaceManager Addon
    Tema ve arayüz ayarları yönetimi
]]

local InterfaceManager = {}
InterfaceManager.__index = InterfaceManager

local HttpService = game:GetService("HttpService")

InterfaceManager.Library = nil
InterfaceManager.Folder = "NexusUI"
InterfaceManager.Settings = {
    Theme = "Dark",
    Transparency = false,
    MenuKeybind = "RightControl"
}

function InterfaceManager:SetLibrary(library)
    self.Library = library
end

function InterfaceManager:SetFolder(folder)
    self.Folder = folder
    
    pcall(function()
        if not isfolder(self.Folder) then
            makefolder(self.Folder)
        end
    end)
end

function InterfaceManager:SaveSettings()
    local success = pcall(function()
        writefile(
            self.Folder .. "/interface.json",
            HttpService:JSONEncode(self.Settings)
        )
    end)
    return success
end

function InterfaceManager:LoadSettings()
    local success, result = pcall(function()
        return readfile(self.Folder .. "/interface.json")
    end)
    
    if success then
        local data = HttpService:JSONDecode(result)
        for key, value in pairs(data) do
            self.Settings[key] = value
        end
    end
    
    return success
end

function InterfaceManager:BuildInterfaceSection(tab)
    if not self.Library or not tab then return end
    
    self:LoadSettings()
    
    tab:AddSection("Interface")
    
    -- Theme Selector
    local themes = {}
    for themeName, _ in pairs(self.Library.Themes) do
        table.insert(themes, themeName)
    end
    
    tab:AddDropdown("InterfaceTheme", {
        Title = "Theme",
        Description = "Change the UI color theme",
        Values = themes,
        Default = table.find(themes, self.Settings.Theme) or 1,
        Callback = function(value)
            self.Library:SetTheme(value)
            self.Settings.Theme = value
            self:SaveSettings()
        end
    })
    
    -- Menu Keybind
    tab:AddKeybind("MenuKeybind", {
        Title = "Menu Toggle Key",
        Default = self.Settings.MenuKeybind,
        Mode = "Toggle",
        ChangedCallback = function(value)
            self.Settings.MenuKeybind = value
            self:SaveSettings()
        end
    })
    
    -- Apply saved theme
    if self.Settings.Theme then
        self.Library:SetTheme(self.Settings.Theme)
    end
end

return InterfaceManager
